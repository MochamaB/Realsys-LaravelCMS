# Frontend - Theme Integration

This document outlines the process of integrating the Miata HTML template into the CMS as a Laravel theme.

## Theme Structure

The Miata template will be converted into a Laravel theme with the following structure:

```
resources/
  themes/
    miata/
      theme.json                # Theme metadata
      templates/                # Page templates
      components/               # Widget components
      layouts/                  # Layout templates
      partials/                 # Reusable partials
      assets/                   # Theme assets
```

## Theme Configuration

The `theme.json` file will define the theme's metadata:

```json
{
  "name": "Miata",
  "slug": "miata",
  "description": "A modern, responsive theme for the NPPK website",
  "version": "1.0.0",
  "author": "NPPK Development Team",
  "supports": {
    "widgets": ["slider", "featured", "testimonial", "team", "counter", "cta"],
    "templates": ["home", "about", "contact", "default"]
  },
  "options": {
    "colors": {
      "primary": "#ff5e14",
      "secondary": "#1a1e25",
      "text": "#677294",
      "heading": "#1a1e25",
      "background": "#ffffff"
    },
    "fonts": {
      "heading": "Poppins, sans-serif",
      "body": "Roboto, sans-serif"
    }
  }
}
```

## Conversion Process

### 1. Extract Layout Structure

The first step is to extract the common layout structure from the Miata template:

```php
<!-- resources/themes/miata/layouts/default.blade.php -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ $page->meta_title ?? $page->title }} - {{ config('app.name') }}</title>
    <meta name="description" content="{{ $page->meta_description }}">
    <meta name="keywords" content="{{ $page->meta_keywords }}">
    
    <!-- Favicon -->
    <link rel="icon" href="{{ theme_asset('images/favicon.png') }}">
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="{{ theme_asset('css/bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ theme_asset('css/all.min.css') }}">
    <link rel="stylesheet" href="{{ theme_asset('css/animate.min.css') }}">
    <link rel="stylesheet" href="{{ theme_asset('css/nice-select.css') }}">
    <link rel="stylesheet" href="{{ theme_asset('css/slick.css') }}">
    <link rel="stylesheet" href="{{ theme_asset('css/style.css') }}">
    <link rel="stylesheet" href="{{ theme_asset('css/responsive.css') }}">
    
    @stack('styles')
</head>
<body>
    <!-- Preloader -->
    <div class="preloader">
        <div class="loader">
            <img src="{{ theme_asset('images/preloader.gif') }}" alt="Preloader">
        </div>
    </div>
    
    <!-- Header -->
    @include('theme::partials.header')
    
    <!-- Main Content -->
    @yield('content')
    
    <!-- Footer -->
    @include('theme::partials.footer')
    
    <!-- Back to Top -->
    <a href="#" class="back-to-top"><i class="fas fa-angle-up"></i></a>
    
    <!-- JS Files -->
    <script src="{{ theme_asset('js/jquery-3.6.0.min.js') }}"></script>
    <script src="{{ theme_asset('js/bootstrap.bundle.min.js') }}"></script>
    <script src="{{ theme_asset('js/slick.min.js') }}"></script>
    <script src="{{ theme_asset('js/jquery.nice-select.min.js') }}"></script>
    <script src="{{ theme_asset('js/wow.min.js') }}"></script>
    <script src="{{ theme_asset('js/main.js') }}"></script>
    
    @stack('scripts')
</body>
</html>
```

### 2. Create Partials

Extract reusable sections into partials:

```php
<!-- resources/themes/miata/partials/header.blade.php -->
<header class="header-area">
    <div class="header-top">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-6">
                    <div class="header-contact">
                        <a href="tel:{{ settings('contact_phone') }}"><i class="fas fa-phone-alt"></i> {{ settings('contact_phone') }}</a>
                        <a href="mailto:{{ settings('contact_email') }}"><i class="fas fa-envelope"></i> {{ settings('contact_email') }}</a>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="header-right">
                        <div class="social-links">
                            @foreach(settings('social_media', []) as $platform => $url)
                                <a href="{{ $url }}"><i class="fab fa-{{ $platform }}"></i></a>
                            @endforeach
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="header-bottom">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-3">
                    <div class="logo">
                        <a href="{{ route('home') }}">
                            <img src="{{ settings('site_logo') ? asset('storage/' . settings('site_logo')) : theme_asset('images/logo.png') }}" alt="{{ config('app.name') }}">
                        </a>
                    </div>
                </div>
                <div class="col-lg-9">
                    <div class="main-menu">
                        @include('theme::partials.navigation')
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
```

```php
<!-- resources/themes/miata/partials/navigation.blade.php -->
<nav class="navbar navbar-expand-lg">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"><i class="fas fa-bars"></i></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
            @if($mainMenu)
                @foreach($mainMenu->topLevelItems()->get() as $item)
                    @if($item->children->count() > 0)
                        <li class="nav-item dropdown {{ $item->isActive() ? 'active' : '' }}">
                            <a class="nav-link dropdown-toggle" href="{{ $item->getUrl() }}" role="button" data-bs-toggle="dropdown">
                                {{ $item->title }}
                            </a>
                            <ul class="dropdown-menu">
                                @foreach($item->children as $child)
                                    <li><a class="dropdown-item {{ $child->isActive() ? 'active' : '' }}" href="{{ $child->getUrl() }}">{{ $child->title }}</a></li>
                                @endforeach
                            </ul>
                        </li>
                    @else
                        <li class="nav-item {{ $item->isActive() ? 'active' : '' }}">
                            <a class="nav-link" href="{{ $item->getUrl() }}">{{ $item->title }}</a>
                        </li>
                    @endif
                @endforeach
            @endif
        </ul>
    </div>
</nav>
```

```php
<!-- resources/themes/miata/partials/footer.blade.php -->
<footer class="footer-area">
    <div class="footer-top">
        <div class="container">
            <div class="row">
                <div class="col-lg-4 col-md-6">
                    <div class="footer-widget about-widget">
                        <div class="footer-logo">
                            <img src="{{ settings('site_logo') ? asset('storage/' . settings('site_logo')) : theme_asset('images/logo-white.png') }}" alt="{{ config('app.name') }}">
                        </div>
                        <p>{{ settings('site_description') }}</p>
                        <div class="social-links">
                            @foreach(settings('social_media', []) as $platform => $url)
                                <a href="{{ $url }}"><i class="fab fa-{{ $platform }}"></i></a>
                            @endforeach
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-6">
                    <div class="footer-widget link-widget">
                        <h4 class="widget-title">Quick Links</h4>
                        <ul class="links">
                            @if($footerMenu)
                                @foreach($footerMenu->items()->take(6)->get() as $item)
                                    <li><a href="{{ $item->getUrl() }}">{{ $item->title }}</a></li>
                                @endforeach
                            @endif
                        </ul>
                    </div>
                </div>
                <div class="col-lg-4 col-md-6">
                    <div class="footer-widget contact-widget">
                        <h4 class="widget-title">Contact Us</h4>
                        <div class="contact-info">
                            <p><i class="fas fa-map-marker-alt"></i> {{ settings('contact_address') }}</p>
                            <p><i class="fas fa-phone-alt"></i> {{ settings('contact_phone') }}</p>
                            <p><i class="fas fa-envelope"></i> {{ settings('contact_email') }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="footer-bottom">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="copyright-text">
                        <p>{!! settings('footer_text', '&copy; ' . date('Y') . ' ' . config('app.name') . '. All Rights Reserved.') !!}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</footer>
```

### 3. Create Page Templates

Convert each page type from the Miata template into a Blade template:

```php
<!-- resources/themes/miata/templates/home.blade.php -->
{{-- 
name: Home Page
description: Template for the site homepage
sections: hero, featured, about, services, counter, team, testimonials, cta
--}}

@extends('theme::layouts.default')

@section('content')
    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container">
            @foreach($page->getWidgetsBySection('hero') as $widget)
                {!! $widget->render() !!}
            @endforeach
        </div>
    </section>
    
    <!-- Featured Section -->
    <section class="featured-section section-padding">
        <div class="container">
            @foreach($page->getWidgetsBySection('featured') as $widget)
                {!! $widget->render() !!}
            @endforeach
        </div>
    </section>
    
    <!-- About Section -->
    <section class="about-section section-padding">
        <div class="container">
            @foreach($page->getWidgetsBySection('about') as $widget)
                {!! $widget->render() !!}
            @endforeach
        </div>
    </section>
    
    <!-- Services Section -->
    <section class="services-section section-padding bg-light">
        <div class="container">
            @foreach($page->getWidgetsBySection('services') as $widget)
                {!! $widget->render() !!}
            @endforeach
        </div>
    </section>
    
    <!-- Counter Section -->
    <section class="counter-section section-padding">
        <div class="container">
            @foreach($page->getWidgetsBySection('counter') as $widget)
                {!! $widget->render() !!}
            @endforeach
        </div>
    </section>
    
    <!-- Team Section -->
    <section class="team-section section-padding bg-light">
        <div class="container">
            @foreach($page->getWidgetsBySection('team') as $widget)
                {!! $widget->render() !!}
            @endforeach
        </div>
    </section>
    
    <!-- Testimonials Section -->
    <section class="testimonials-section section-padding">
        <div class="container">
            @foreach($page->getWidgetsBySection('testimonials') as $widget)
                {!! $widget->render() !!}
            @endforeach
        </div>
    </section>
    
    <!-- CTA Section -->
    <section class="cta-section section-padding bg-primary">
        <div class="container">
            @foreach($page->getWidgetsBySection('cta') as $widget)
                {!! $widget->render() !!}
            @endforeach
        </div>
    </section>
@endsection
```

## Theme Helper Functions

Create helper functions for theme-related operations:

```php
namespace App\Helpers;

use App\Models\Theme;
use Illuminate\Support\Facades\Cache;

if (!function_exists('theme_asset')) {
    /**
     * Generate a URL for a theme asset
     *
     * @param string $path
     * @return string
     */
    function theme_asset($path)
    {
        $theme = Cache::remember('active_theme', 60 * 24, function () {
            return Theme::where('is_active', true)->first();
        });
        
        if (!$theme) {
            return asset($path);
        }
        
        return asset("themes/{$theme->slug}/{$path}");
    }
}

if (!function_exists('settings')) {
    /**
     * Get a setting value
     *
     * @param string $key
     * @param mixed $default
     * @return mixed
     */
    function settings($key, $default = null)
    {
        $settings = Cache::remember('site_settings', 60 * 24, function () {
            return app(\App\Services\SettingsService::class)->getAllSettings();
        });
        
        return $settings[$key] ?? $default;
    }
}
```

## Asset Publishing

The theme assets need to be published to the public directory:

```php
namespace App\Services;

use App\Models\Theme;
use Illuminate\Support\Facades\File;

class ThemeAssetManager
{
    /**
     * Publish theme assets
     *
     * @param Theme $theme
     * @return bool
     */
    public function publishAssets(Theme $theme)
    {
        $themePath = resource_path("themes/{$theme->slug}");
        $assetPath = $themePath . '/assets';
        
        if (!File::isDirectory($assetPath)) {
            return false;
        }
        
        $publicPath = public_path("themes/{$theme->slug}");
        
        // Create public directory if it doesn't exist
        if (!File::isDirectory($publicPath)) {
            File::makeDirectory($publicPath, 0755, true);
        }
        
        // Copy assets
        File::copyDirectory($assetPath, $publicPath);
        
        return true;
    }
}
```

## Theme Registration

The theme needs to be registered in the system:

```php
namespace App\Providers;

use Illuminate\Support\ServiceProvider;
use App\Services\ThemeManager;
use App\Services\ThemeAssetManager;
use App\Models\Theme;

class ThemeServiceProvider extends ServiceProvider
{
    public function boot()
    {
        // Register Miata theme if it doesn't exist
        $this->registerMiataTheme();
        
        // Load views from active theme
        $this->loadActiveThemeViews();
    }
    
    protected function registerMiataTheme()
    {
        $themePath = resource_path('themes/miata');
        
        if (!file_exists($themePath . '/theme.json')) {
            return;
        }
        
        $config = json_decode(file_get_contents($themePath . '/theme.json'), true);
        
        if (!$config) {
            return;
        }
        
        // Register or update theme
        $theme = Theme::firstOrNew(['slug' => 'miata']);
        $theme->name = $config['name'] ?? 'Miata';
        $theme->description = $config['description'] ?? '';
        $theme->version = $config['version'] ?? '1.0.0';
        $theme->author = $config['author'] ?? '';
        $theme->screenshot_path = file_exists($themePath . '/screenshot.png') ? 'themes/miata/screenshot.png' : null;
        
        // If no active theme, set this as active
        if (!Theme::where('is_active', true)->exists()) {
            $theme->is_active = true;
        }
        
        $theme->save();
        
        // Publish assets
        app(ThemeAssetManager::class)->publishAssets($theme);
    }
    
    protected function loadActiveThemeViews()
    {
        $activeTheme = Theme::where('is_active', true)->first();
        
        if ($activeTheme) {
            $themePath = resource_path("themes/{$activeTheme->slug}");
            
            if (file_exists($themePath)) {
                $this->loadViewsFrom($themePath, 'theme');
            }
        }
    }
}
```

## Conclusion

By following this integration process, the Miata HTML template will be converted into a Laravel theme that works seamlessly with the CMS. The theme will provide a modern, responsive design while allowing for dynamic content management through the admin interface.
